<div class="container mt-4">
  <h2>Daftar Berita</h2>

  <div class="d-flex justify-content-center mt-4" *ngIf="isLoading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#tambahBeritaModal">
    Tambah Berita
  </button>

  <div class="modal fade" id="tambahBeritaModal" tabindex="-1" aria-labelledby="tambahBeritaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg"> 
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tambahBeritaModalLabel">Tambah Berita</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="beritaForm" (ngSubmit)="addBerita()">
            <div class="mb-3">
              <label for="judul" class="form-label">Judul Berita</label>
              <input id="judul" type="text" class="form-control" formControlName="judul" />
            </div>
            <div class="mb-3">
              <label for="isiBerita" class="form-label">Isi Berita</label>
              <textarea id="isiBerita" class="form-control" formControlName="isiBerita"></textarea>
            </div>
            <div class="mb-3">
              <label for="tanggalTerbit" class="form-label">Tanggal Terbit</label>
              <input id="tanggalTerbit" type="date" class="form-control" formControlName="tanggalTerbit" />
            </div>
            <div class="mb-3">
              <label for="penulis" class="form-label">Penulis</label>
              <select id="penulis" class="form-select" formControlName="penulis">
                <option *ngFor="let penulis of penulis" [value]="penulis._id">{{ penulis.nama }}</option> 
              </select>
            </div>
            <div class="mb-3">
              <label for="status" class="form-label">Status</label>
              <select id="status" class="form-select" formControlName="status">
                <option value="Draft">Draft</option>
                <option value="Dipublikasikan">Dipublikasikan</option>
                <option value="Diarsipkan">Diarsipkan</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="gambarUtama" class="form-label">URL Gambar Utama</label>
              <input id="gambarUtama" type="text" class="form-control" formControlName="gambarUtama" />
            </div>
            <div class="mb-3">
              <label for="url" class="form-label">URL Berita</label>
              <input id="url" type="text" class="form-control" formControlName="url" />
            </div>
            <div class="mb-3">
              <label for="kategori" class="form-label">Kategori</label>
              <select id="kategori" class="form-select" formControlName="kategori">
                <option *ngFor="let kategori of kategori" [value]="kategori._id">{{ kategori.nama }}</option> 
              </select>
            </div>
            <div class="mb-3">
              <label for="sumber" class="form-label">Sumber</label>
              <select id="sumber" class="form-select" formControlName="sumber" multiple> 
                <option *ngFor="let sumber of sumber" [value]="sumber._id">{{ sumber.nama }}</option> 
              </select>
            </div>
            <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
              {{ isSubmitting ? "Menyimpan..." : "Tambah Berita" }}
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editBeritaModal" tabindex="-1" aria-labelledby="editBeritaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editBeritaModalLabel">Ubah Berita</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="beritaForm" (ngSubmit)="updateBerita()">
            <div class="mb-3">
              <label for="editJudul" class="form-label">Judul Berita</label>
              <input id="editJudul" type="text" class="form-control" formControlName="judul" />
            </div>
            <div class="mb-3">
              <label for="editIsiBerita" class="form-label">Isi Berita</label>
              <textarea id="editIsiBerita" class="form-control" formControlName="isiBerita"></textarea>
            </div>
            <div class="mb-3">
              <label for="editTanggalTerbit" class="form-label">Tanggal Terbit</label>
              <input id="editTanggalTerbit" type="date" class="form-control" formControlName="tanggalTerbit" />
            </div>
            <div class="mb-3">
              <label for="editPenulis" class="form-label">Penulis</label>
              <select id="editPenulis" class="form-select" formControlName="penulis">
                <option *ngFor="let penulis of penulis" [value]="penulis._id">{{ penulis.nama }}</option> 
              </select>
            </div>
            <div class="mb-3">
              <label for="editStatus" class="form-label">Status</label>
              <select id="editStatus" class="form-select" formControlName="status">
                <option value="Draft">Draft</option>
                <option value="Dipublikasikan">Dipublikasikan</option>
                <option value="Diarsipkan">Diarsipkan</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editGambarUtama" class="form-label">URL Gambar Utama</label>
              <input id="editGambarUtama" type="text" class="form-control" formControlName="gambarUtama" />
            </div>
            <div class="mb-3">
              <label for="editUrl" class="form-label">URL Berita</label>
              <input id="editUrl" type="text" class="form-control" formControlName="url" />
            </div>
            <div class="mb-3">
              <label for="editKategori" class="form-label">Kategori</label>
              <select id="editKategori" class="form-select" formControlName="kategori">
                <option *ngFor="let kategori of kategori" [value]="kategori._id">{{ kategori.nama }}</option> 
              </select>
            </div>
            <div class="mb-3">
              <label for="editSumber" class="form-label">Sumber</label>
              <select id="editSumber" class="form-select" formControlName="sumber" multiple> 
                <option *ngFor="let sumber of sumber" [value]="sumber._id">{{ sumber.nama }}</option> 
              </select>
            </div>
            <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
              {{ isSubmitting ? "Menyimpan..." : "Ubah Berita" }}
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="berita.length > 0; else noBerita">
    <div class="row">
      <div class="col-md-4 mb-3" *ngFor="let item of berita | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }; index as i">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ item.judul }}</h5>
            <p class="card-text">{{ item.isiBerita | slice:0:100 }}...</p> 
            <p class="card-text">
              <small class="text-muted">Tanggal Terbit: {{ item.tanggalTerbit | date }}</small>
            </p>
            <p class="card-text">
              <small class="text-muted">Penulis: {{ item.penulis.nama }}</small>
            </p>
            <button type="button" class="btn btn-warning me-2" (click)="getBeritaById(item._id)">
              Edit
            </button>
            <button type="button" class="btn btn-danger" (click)="deleteBerita(item._id)">
              Hapus
            </button>
          </div>
        </div>
      </div>
    </div>

    <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>
  </div>

  <ng-template #noBerita>
    <p *ngIf="!isLoading">Tidak ada berita ditemukan.</p>
  </ng-template>
</div>